-- ================= UI =================
local WindUI = loadstring(game:HttpGet(
    "https://github.com/Footagesus/WindUI/releases/latest/download/main.lua"
))()

local Window = WindUI:CreateWindow({
    Title="à¹„à¸­à¹‰à¹€à¸ˆà¸«à¸³à¸™à¹‰à¸­à¸¢",
    Icon="",
    Author="",
    Folder="kuy",
    Size=UDim2.fromOffset(450,330),
    Theme="Dark",
    Transparent=true,
    Resizable=true,
})



-- ================= SERVICES =================
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")

local lp = Players.LocalPlayer
local char = lp.Character or lp.CharacterAdded:Wait()
local hrp = char:WaitForChild("HumanoidRootPart")

-- ================= CONFIG =================
local CHECK_DISTANCE = 300
local SPEED = 30
local HEIGHT_RESET = 3
local WAVE_SAFE_DIST = 80

local Enabled = false
local tweening = false
local arrived = false
local currentGapPart

local GapsRoot = workspace:WaitForChild("Misc"):WaitForChild("Gaps")

-- NOCLIP
local function setNoclip(state)
	for _,v in ipairs(char:GetDescendants()) do
		if v:IsA("BasePart") then
			v.CanCollide = not state
		end
	end
end

local function getNearestWave()
	local nearest,dist=nil,math.huge
	for _,v in ipairs(workspace:GetChildren()) do
		if v.Name:match("^Wave%d+_Visual$") then
			local pos=v:IsA("BasePart") and v.Position or v.PrimaryPart and v.PrimaryPart.Position
			if pos then
				local d=(hrp.Position-pos).Magnitude
				if d<dist then
					dist=d
					nearest=pos
				end
			end
		end
	end
	return nearest,dist
end

local function waveBlockingGap(wavePos,gapPos)
	local toGap=(gapPos-hrp.Position)
	local toWave=(wavePos-hrp.Position)
	if toGap.Magnitude==0 or toWave.Magnitude==0 then return false end
	if toGap.Unit:Dot(toWave.Unit)<0.6 then return false end
	return toWave.Magnitude<toGap.Magnitude and toWave.Magnitude<WAVE_SAFE_DIST
end
local function getBestGap()
	local best,bestDist=nil,math.huge
	local wavePos,waveDist=getNearestWave()

	for _,gap in ipairs(GapsRoot:GetChildren()) do
		local part=gap:GetChildren()[2]
		local gp=part and (part:IsA("BasePart") and part or part.PrimaryPart)
		if gp then
			local dist=(hrp.Position-gp.Position).Magnitude
			local blocked=false
			if wavePos and waveDist<=CHECK_DISTANCE then
				blocked=waveBlockingGap(wavePos,gp.Position)
			end
			if not blocked and dist<bestDist then
				bestDist=dist
				best=gp
			end
		end
	end
	return best
end

-- ================= TWEEN =================
local function tweenToGap()
	if tweening or arrived then return end
	tweening=true

	local gap=getBestGap()
	if not gap then tweening=false return end
	currentGapPart=gap

	setNoclip(true)

	-- à¸¥à¸‡à¸”à¸´à¸™à¸à¹ˆà¸­à¸™
	local downPos=hrp.Position-Vector3.new(0,3,0)
	local downTween=TweenService:Create(
		hrp,
		TweenInfo.new(3/SPEED,Enum.EasingStyle.Linear),
		{CFrame=CFrame.new(downPos)}
	)
	downTween:Play()

	downTween.Completed:Once(function()
		local target=gap.Position+Vector3.new(0,3,0)
		local time=(hrp.Position-target).Magnitude/SPEED

		local goTween=TweenService:Create(
			hrp,
			TweenInfo.new(time,Enum.EasingStyle.Linear),
			{CFrame=CFrame.new(target)}
		)
		goTween:Play()

		goTween.Completed:Once(function()
			setNoclip(false)
			tweening=false
			arrived=true
		end)
	end)
end

-- LOOP
RunService.Heartbeat:Connect(function()
	if not Enabled then return end

	if arrived and currentGapPart then
		if math.abs(hrp.Position.Y-currentGapPart.Position.Y)>HEIGHT_RESET then
			arrived=false
			currentGapPart=nil
		end
	end
	if arrived then return end

	local _,waveDist=getNearestWave()
	if waveDist and waveDist<=CHECK_DISTANCE then
		tweenToGap()
	end
end)

local MainTab = Window:Tab({Title="Main",Icon="user"})

MainTab:Toggle({
    Title="Auto dodge WaveðŸŒŠ",
    Desc="à¸«à¸™à¸µà¸„à¸¥à¸·à¹ˆà¸™à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´",
    Default=false,
    Callback=function(state)
        Enabled=state
    end
})
